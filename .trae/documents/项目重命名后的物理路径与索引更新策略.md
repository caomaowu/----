### 1. 关于“为什么不重命名物理文件夹”的讨论

这是一个非常经典的权衡问题，通常基于以下考虑：

**不重命名的优点 (保守策略):**

* **安全性**: 如果文件夹中有文件正在被打开（如 Word, Excel, CAD 软件），重命名操作会直接失败，甚至可能导致数据损坏。在 Windows 上，文件锁是非常常见的。

* **稳定性**: 外部链接失效风险低。如果其他系统或快捷方式链接到了这个文件夹，重命名会导致链接断裂。

* **唯一性**: 文件夹名通常包含 ID（如 `PRJ-202402-001`），这才是核心标识。名字只是给人看的标签。

**重命名的优点 (激进策略):**

* **一致性**: 文件夹名与项目名保持一致，便于在文件资源管理器中直接查找。

* **直观性**: 用户在 NAS 或本地浏览时不会感到困惑（例如项目叫 "新特斯"，文件夹却还叫 "旧特斯拉"）。

**我的建议**:
如果您的项目文件夹主要由自己管理，且能确保重命名时文件未被占用，我们可以实现**尝试性重命名**。即：尝试重命名，如果成功则更新路径；如果失败（被占用），则保留原名并提示用户，但仅更新系统内的显示名称。这样既能保持一致性，又不会导致程序崩溃。

### 2. 关于“重命名后探伤索引没变”的原因分析

**原因**:
探伤记录的匹配逻辑（`SmartMatcher`）是基于**项目名称**、**客户代码**、**零件号**等信息实时计算或在扫描时计算的。

* **数据库滞后**: 数据库中存储的 `external_resources` 表包含 `match_score`。这个分数是在**扫描时**计算并写入的。

* **未触发重新扫描**: 当您修改项目名称后，系统仅仅更新了项目的元数据，**并没有**自动触发针对该项目的重新扫描和匹配分数更新。因此，旧的匹配结果（基于旧名字计算的分数）依然保留在数据库中。

### 解决方案

针对您的两个问题，我建议执行以下方案：

#### 方案 A: 实现物理文件夹重命名（执行）

如果您希望文件夹名随项目名变更：

1. 在 `project_service.py` 中实现 `rename_project_folder` 逻辑。
2. 在修改名称时尝试调用该逻辑。
3. 更新数据库中的 `project_dir` 路径。

#### 方案 B: 解决探伤索引更新 (必须)

1. 在 `_manage_project` 保存成功后，如果检测到**名称**、**客户代码**或**零件号**发生了变更。
2. **立即触发**一次针对该项目的增量扫描 (`targeted_scan_and_link`)。
3. 这将使用新的项目信息重新计算匹配分数，并更新数据库。

**您是否同意实施方案 B？关于方案 A（物理重命名），您倾向于“保持现状”还是“尝试重命名”？**
