# 压铸项目管理系统 - 外部资源关联实施计划

根据您提供的 `EXTERNAL_RESOURCES.md` 设计文档，结合现有代码库的分析，我制定了以下实施计划。

## 🔍 现状分析与调整

1. **设置页面**: 现有系统无独立设置页，需新建 `SettingsInterface` 以符合 Fluent Design 规范，并添加“外部资源集成”卡片。
2. **项目详情页**: 目前仅为文件浏览器，需重构为带 Tab 的视图，以容纳新增的“探伤记录”时间轴。
3. **数据库**: 现有 `index_db.py` 结构良好，可直接扩展。

## 📅 实施路线图

### Phase 1: 基础设施 (Infrastructure)

> 目标：建立数据存储与领域模型

1. **数据库迁移**:

   * 修改 `dcpm/infra/db/index_db.py`，在 `_ensure_schema` 中新增 `external_resources` 表。

   * 实现该表的 CRUD 操作函数。
2. **领域模型**:

   * 创建 `dcpm/domain/external_resource.py`，定义 `ExternalResource` 数据类（包含路径、分数、状态等）。

### Phase 2: 核心服务 (Core Services)

> 目标：实现智能扫描与模糊匹配

1. **扫描器**:

   * 创建 `dcpm/services/scanner_service.py`。

   * 实现 `InspectionScanner` 类，支持 `os.scandir` 定向遍历共享盘。
2. **匹配引擎**:

   * 实现 `SmartMatcher` 类，包含规则：

     * 强特征匹配 (Customer Code/Part Number)

     * 名称关键词分词匹配

     * 同义词映射 (前梁/Front, 探伤/Xray)

### Phase 3: 设置界面 (Settings UI)

> 目标：提供配置入口，对齐 Fluent Design

1. **新建设置页**:

   * 创建 `dcpm/ui/views/settings_interface.py`。

   * 添加“外部资源集成”设置卡片：

     * 路径输入框 (UNC Path)

     * “立即扫描”按钮 (带进度条)
2. **导航集成**:

   * 修改 `dcpm/ui/views/sidebar.py`，在底部添加设置按钮。

   * 修改 `dcpm/ui/main_window.py` 路由逻辑。

### Phase 4: 项目详情页集成 (Integration)

> 目标：在项目详情中展示时间轴

1. **时间轴组件**:

   * 开发 `dcpm/ui/views/inspection_timeline.py`，以时间轴形式展示 `pending`/`confirmed` 的资源。

   * 实现“打开文件夹”和“确认关联”交互。
2. **视图重构**:

   * 重构 `dcpm/ui/views/file_browser.py`。

   * 引入 `Pivot` (Tab栏) 切换 \[项目文件] | \[探伤记录]。

***

**技术细节确认**:

* 语言: Python 3.12+ / PyQt6

* UI 库: PyQt-Fluent-Widgets (保持美观统一)

* 终端: PowerShell (用于后续验证)

